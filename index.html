<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Timelapse Forum</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; }
.container { max-width:1200px; margin:auto; padding:20px; }
header { display:flex; justify-content:space-between; align-items:center; background:#333; color:#fff; padding:10px 20px; border-radius:5px; }
header h1 { margin:0; }
button { cursor:pointer; padding:5px 10px; border:none; border-radius:3px; background:#4CAF50; color:#fff; }
.main-content { display:flex; gap:20px; margin-top:20px; }
.video-player-section { flex:2; }
.video-player-section video { width:100%; max-height:500px; border-radius:5px; background:#000; }
.video-list-section { flex:1; max-height:500px; overflow-y:auto; background:#fff; padding:10px; border-radius:5px; }
ul { list-style:none; padding:0; margin:0; }
li { margin-bottom:10px; cursor:pointer; }
li:hover { background:#eee; }
.upload-section { margin-top:20px; background:#fff; padding:10px; border-radius:5px; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
</head>
<body>
<div class="container">
<header>
<h1>3D Printer Timelapse Forum</h1>
<div id="user-info">
<button id="login-btn">Zaloguj przez Google</button>
<span id="user-name"></span>
<button id="logout-btn" style="display:none;">Wyloguj</button>
</div>
</header>
<main class="main-content">
<section class="video-player-section">
<video id="main-video" controls autoplay></video>
<h2 id="main-video-title"></h2>
<p id="main-video-user"></p>
</section>
<aside class="video-list-section">
<h3>Najnowsze filmy</h3>
<ul id="video-list"></ul>
</aside>
</main>
<section class="upload-section">
<h3>Dodaj nowy timelapse</h3>
<input type="text" id="video-title" placeholder="Tytuł filmu">
<input type="file" id="video-file" accept="video/*">
<button id="upload-btn">Wyślij wideo</button>
<div id="upload-progress"></div>
<div id="upload-error"></div>
</section>
</div>
<script>
// === Firebase config ===
const FIREBASE_CONFIG = {
  apiKey: "REPLACE_ME",
  authDomain: "REPLACE_ME",
  projectId: "REPLACE_ME",
  storageBucket: "REPLACE_ME",
  messagingSenderId: "REPLACE_ME",
  appId: "REPLACE_ME"
};

firebase.initializeApp(FIREBASE_CONFIG);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();
let currentUser = null;

const loginBtn = document.getElementById('login-btn');
const logoutBtn = document.getElementById('logout-btn');
const userNameSpan = document.getElementById('user-name');
const videoList = document.getElementById('video-list');
const mainVideo = document.getElementById('main-video');
const mainVideoTitle = document.getElementById('main-video-title');
const mainVideoUser = document.getElementById('main-video-user');
const uploadBtn = document.getElementById('upload-btn');
const videoTitleInput = document.getElementById('video-title');
const videoFileInput = document.getElementById('video-file');
const uploadProgressDiv = document.getElementById('upload-progress');
const uploadErrorDiv = document.getElementById('upload-error');

loginBtn.addEventListener('click', ()=>{
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
});
logoutBtn.addEventListener('click', ()=>{ auth.signOut(); });

auth.onAuthStateChanged(user=>{
  currentUser = user;
  if(user){
    loginBtn.style.display='none';
    logoutBtn.style.display='inline-block';
    userNameSpan.textContent = user.displayName || user.email;
  } else {
    loginBtn.style.display='inline-block';
    logoutBtn.style.display='none';
    userNameSpan.textContent='';
  }
});

function renderVideos(){
  db.collection('videos').orderBy('createdAt','desc').onSnapshot(snapshot=>{
    videoList.innerHTML='';
    snapshot.docs.forEach(doc=>{
      const data = doc.data();
      const li = document.createElement('li');
      li.textContent = data.title + ' - ' + data.displayName;
      li.addEventListener('click', ()=>{
        mainVideo.src = data.url;
        mainVideoTitle.textContent = data.title;
        mainVideoUser.textContent = data.displayName;
      });
      li.addEventListener('dblclick', ()=>{
        window.location.href = window.location.href.split('?')[0]+'?uid='+data.uid;
      });
      videoList.appendChild(li);
    });
  });
}

uploadBtn.addEventListener('click', ()=>{
  if(!currentUser){ uploadErrorDiv.textContent='Musisz się zalogować.'; return; }
  const file = videoFileInput.files[0];
  if(!file){ uploadErrorDiv.textContent='Wybierz plik.'; return; }
  const title = videoTitleInput.value.trim() || file.name;
  const path = 'videos/'+currentUser.uid+'/'+Date.now()+'_'+file.name;
  const storageRef = firebase.storage().ref(path);
  const uploadTask = storageRef.put(file);
  uploadTask.on('state_changed', snapshot=>{
    const prog = Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);
    uploadProgressDiv.textContent = 'Postęp: '+prog+'%';
  }, error=>{ uploadErrorDiv.textContent='Błąd uploadu: '+error.message; }, ()=>{
    uploadTask.snapshot.ref.getDownloadURL().then(url=>{
      db.collection('videos').add({
        title: title,
        url: url,
        uid: currentUser.uid,
        displayName: currentUser.displayName || currentUser.email,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      videoTitleInput.value=''; videoFileInput.value=''; uploadProgressDiv.textContent=''; uploadErrorDiv.textContent='';
    });
  });
});

renderVideos();
</script>
</body>
</html>
